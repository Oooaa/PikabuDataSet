Нужно связать все пересечения. Это очень занятное дело. Но у меня есть секрет, как сделать это быстрее.